env:
   WORKDIR: "/tmp/cirrus-ci-build"
   CIRRUS_CLONE_DEPTH: "1"
task:
  name: "bui"
  timeout_in: 2h
  container:
        image: apon77/aosp:cirrus
        cpu: 8
        memory: 32G
   
  Chck_background_script:
     - cat /etc/os* && env && pwd && nproc && gcc --version && clang --version
  S-ync_script:
     - cd $CIRRUS_WORKING_DIR
     - chmod u+r+x s.sh
     - ./s.sh
  B-u_script:
     - cd $WORKDIR
     - export PATH="/usr/lib/ccache:$PATH"
     - export CCACHE_DIR=$WORKDIR/ccache
     - export CCACHE_EXEC=/usr/bin/ccache
     - export USE_CCACHE=1
     - export CCACHE_DEPEND=true
     - export CCACHE_FILECLONE=true
     - export CCACHE_LIMIT_MULTIPLE=0.9
     - export CCACHE_NOCOMPRESS=true
     - export CCACHE_NOHASHDIR=1
     - which ccache
     - ccache -M 100
     - ccache -z
     - command=$(tail $CIRRUS_WORKING_DIR/b.sh -n +$(expr $(grep 'build/envsetup.sh' $CIRRUS_WORKING_DIR/b.sh -n | cut -f1 -d:) - 1)| head -n -1 | grep -v '# upload rom')
     - bash -c "$command"
